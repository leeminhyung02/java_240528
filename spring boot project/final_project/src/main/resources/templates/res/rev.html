<!DOCTYPE html>
<html 
	xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/layout.html}">
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<style type="text/css">
.wrap {
    height: 100vh;
    min-height: 400px;
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: column;
    gap: 32px;
}

h1 {
    font-size: 40px;
    font-weight: 600;
}

.rating {
    float: none;
    width: 200px;
    display: flex;

    &__input {
        display: none;
    }

    &__label {
        width: 20px;
        overflow: hidden;
        cursor: pointer;

        .star-icon {
            width: 20px;
            height: 40px;
            display: block;
            position: relative;
            left: 0;
            background-image: url('https://velog.velcdn.com/images/jellykelly/post/9957327f-f358-4c25-9989-5bb3dd5755d6/image.svg');
            background-repeat: no-repeat;
            background-size: 40px;
          
            &.filled {
                background-image: url('https://velog.velcdn.com/images/jellykelly/post/10caf033-b0ef-4d58-804b-6e33395e4ea5/image.svg');
            }
        }

        &--full .star-icon {
            background-position: right;
        }

        &--half .star-icon {
            background-position: left;
        }
    }

    &.readonly {
        .star-icon {
            opacity: 0.7;
            cursor: default;
        }
    }
}
</style>
</head>
<body >
	<main layout:fragment="content">
				<script type="text/javascript">
				const rateWrap = document.querySelectorAll('.rating'),
		        label = document.querySelectorAll('.rating .rating__label'),
		        input = document.querySelectorAll('.rating .rating__input'),
		        labelLength = label.length,
		        opacityHover = '0.5';
		
		let stars = document.querySelectorAll('.rating .star-icon');
		
		checkedRate();
		
		rateWrap.forEach(wrap => {
		    wrap.addEventListener('mouseenter', () => {
		        stars = wrap.querySelectorAll('.star-icon');
		
		        stars.forEach((starIcon, idx) => {
		            starIcon.addEventListener('mouseenter', () => {
		                initStars(); 
		                filledRate(idx, labelLength); 
		
		                for (let i = 0; i < stars.length; i++) {
		                    if (stars[i].classList.contains('filled')) {
		                        stars[i].style.opacity = opacityHover;
		                    }
		                }
		            });
		
		            starIcon.addEventListener('mouseleave', () => {
		                starIcon.style.opacity = '1';
		                checkedRate(); 
		            });
		
		            wrap.addEventListener('mouseleave', () => {
		                starIcon.style.opacity = '1';
		            });
		        });
		    });
		});
		
		function filledRate(index, length) {
		    if (index <= length) {
		        for (let i = 0; i <= index; i++) {
		            stars[i].classList.add('filled');
		        }
		    }
		}
		
		function checkedRate() {
		    let checkedRadio = document.querySelectorAll('.rating input[type="radio"]:checked');
		
		
		    initStars();
		    checkedRadio.forEach(radio => {
		        let previousSiblings = prevAll(radio);
		
		        for (let i = 0; i < previousSiblings.length; i++) {
		            previousSiblings[i].querySelector('.star-icon').classList.add('filled');
		        }
		
		        radio.nextElementSibling.classList.add('filled');
		
		        function prevAll() {
		            let radioSiblings = [],
		                prevSibling = radio.parentElement.previousElementSibling;
		
		            while (prevSibling) {
		                radioSiblings.push(prevSibling);
		                prevSibling = prevSibling.previousElementSibling;
		            }
		            return radioSiblings;
		        }
		    });
		}
		
		function initStars() {
		    for (let i = 0; i < stars.length; i++) {
		        stars[i].classList.remove('filled');
		    }
		}
</script>
		<div class="container m-auto">
			<form th:action="@{/res/rev/{res_id}(res_id=${res_id})}" method="post">
				  <div class="form-group">
					    <label for="score">점수</label>
					    <div class="wrap">
				    <h1>Star rating</h1>
				    <div class="rating">
				        <label class="rating__label 
				        rating__label--half" for="starhalf">
				            <input type="radio" id="starhalf" class="rating__input" name="rating" value="0.5">
				            <span class="star-icon"></span>
				        </label>
				        <label class="rating__label rating__label--full" for="star1">
				            <input type="radio" id="star1" class="rating__input" name="rating" value="1">
				            <span class="star-icon"></span>
				        </label>
				        <label class="rating__label rating__label--half" for="star1half">
				            <input type="radio" id="star1half" class="rating__input" name="rating" value="1.5">
				            <span class="star-icon"></span>
				        </label>
				        <label class="rating__label rating__label--full" for="star2">
				            <input type="radio" id="star2" class="rating__input" name="rating" value="2">
				            <span class="star-icon"></span>
				        </label>
				        <label class="rating__label rating__label--half" for="star2half">
				            <input type="radio" id="star2half" class="rating__input" name="rating" value="2.5">
				            <span class="star-icon"></span>
				        </label>
				        <label class="rating__label rating__label--full" for="star3">
				            <input type="radio" id="star3" class="rating__input" name="rating" value="3">
				            <span class="star-icon"></span>
				        </label>
				        <label class="rating__label rating__label--half" for="star3half">
				            <input type="radio" id="star3half" class="rating__input" name="rating" checked value="3.5">
				            <span class="star-icon"></span>
				        </label>
				        <label class="rating__label rating__label--full" for="star4">
				            <input type="radio" id="star4" class="rating__input" name="rating" value="4">
				            <span class="star-icon"></span>
				        </label>
				        <label class="rating__label rating__label--half" for="star4half">
				            <input type="radio" id="star4half" class="rating__input" name="rating" value="4.5">
				            <span class="star-icon"></span>
				        </label>
				        <label class="rating__label rating__label--full" for="star5">
				            <input type="radio" id="star5" class="rating__input" name="rating" value="5">
				            <span class="star-icon"></span>
				        </label>
				    </div>
				</div>
				  </div>
				  <div class="form-group">
					    <label for="content">내용</label>
					    <textarea class="form-control" placeholder="내용" id="content" rows="30" cols="5" name="content"></textarea>
				  </div>
				  <div>
				  		<input type="hidden" class="form-control" th:value="${#authentication.principal.member.User_id}" name="User_id">
				  </div>
				  <button type="submit" class="btn btn-primary">리뷰 쓰기</button>
			</form>
		</div>
	</main>
</body>
</html>